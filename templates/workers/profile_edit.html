{% extends 'workers/base_worker.html' %}
{% load static %}

{% block page_title %}Edit Profile{% endblock %}

{% block extra_css %}
<style>
    .profile-edit-container {
        padding: 0;
        max-width: 100%;
        margin: 0;
    }

    .back-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: #6b7280;
        text-decoration: none;
        font-weight: 600;
        margin-bottom: 1.25rem;
        transition: color 0.2s;
    }

    .back-link:hover {
        color: #0f766e;
    }

    .page-header {
        margin-bottom: 1.25rem;
    }

    .page-header h1 {
        font-size: 1.75rem;
        font-weight: 700;
        color: #111827;
        margin-bottom: 0.375rem;
    }

    .page-header p {
        color: #6b7280;
        font-size: 0.9375rem;
    }

    .profile-form-card {
        background: white;
        border-radius: 14px;
        padding: 1.25rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .form-section {
        margin-bottom: 1.5rem;
        padding-bottom: 1.25rem;
        border-bottom: 1px solid #e5e7eb;
    }

    .form-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }

    .section-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1.25rem;
    }

    .section-icon {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.125rem;
    }

    .section-title h2 {
        font-size: 1.25rem;
        font-weight: 700;
        color: #111827;
        margin: 0;
    }

    .section-title p {
        font-size: 0.8125rem;
        color: #6b7280;
        margin: 0;
    }

    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.25rem;
    }

    .form-group {
        display: flex;
        flex-direction: column;
    }

    .form-group.full-width {
        grid-column: 1 / -1;
    }

    .form-label {
        font-size: 0.875rem;
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.375rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .form-label i {
        color: #0f766e;
        font-size: 0.8125rem;
    }

    .required {
        color: #ef4444;
        margin-left: 0.25rem;
    }

    .form-control,
    .form-select {
        padding: 0.625rem 0.75rem;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        font-size: 0.875rem;
        transition: all 0.2s;
        background: white;
    }

    .form-control:focus,
    .form-select:focus {
        outline: none;
        border-color: #0f766e;
        box-shadow: 0 0 0 3px rgba(15, 118, 110, 0.1);
    }

    textarea.form-control {
        resize: vertical;
        min-height: 100px;
        line-height: 1.6;
    }

    .form-help {
        font-size: 0.8125rem;
        color: #6b7280;
        margin-top: 0.375rem;
    }

    .profile-image-upload {
        display: flex;
        align-items: center;
        gap: 1.25rem;
    }

    .current-profile-image {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #0f766e;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .profile-image-placeholder {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 3rem;
        font-weight: 600;
        border: 3px solid #0f766e;
    }

    .profile-image-info {
        flex: 1;
    }

    .profile-image-info h4 {
        font-size: 0.875rem;
        font-weight: 600;
        color: #111827;
        margin-bottom: 0.375rem;
    }

    .profile-image-info p {
        font-size: 0.8125rem;
        color: #6b7280;
        margin-bottom: 0.625rem;
    }

    .checkbox-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 0.75rem;
        margin-top: 0.75rem;
    }

    .checkbox-item {
        display: flex;
        align-items: center;
        padding: 0.75rem;
        background: #f9fafb;
        border-radius: 10px;
        border: 2px solid transparent;
        transition: all 0.2s;
        cursor: pointer;
    }

    .checkbox-item:hover {
        background: #f3f4f6;
        border-color: #0f766e20;
    }

    .checkbox-item input[type="checkbox"] {
        width: 20px;
        height: 20px;
        margin-right: 0.75rem;
        cursor: pointer;
        accent-color: #0f766e;
    }

    .checkbox-item input[type="checkbox"]:checked + label {
        color: #0f766e;
        font-weight: 600;
    }

    .checkbox-item label {
        font-size: 0.9375rem;
        color: #4b5563;
        cursor: pointer;
        margin: 0;
    }

    .input-group {
        display: flex;
        align-items: center;
        position: relative;
    }

    .input-prefix {
        position: absolute;
        left: 0.875rem;
        color: #6b7280;
        font-weight: 600;
        pointer-events: none;
    }

    .input-group .form-control {
        padding-left: 2.25rem;
    }

    .profile-completion {
        background: linear-gradient(135deg, #0f766e15 0%, #14b8a615 100%);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }

    .completion-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
    }

    .completion-title {
        font-size: 0.9375rem;
        font-weight: 600;
        color: #111827;
    }

    .completion-percent {
        font-size: 1.125rem;
        font-weight: 700;
        color: #0f766e;
    }

    .progress-bar {
        height: 10px;
        background: white;
        border-radius: 20px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #0f766e 0%, #14b8a6 100%);
        border-radius: 20px;
        transition: width 0.3s;
    }

    .form-actions {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 2px solid #e5e7eb;
    }

    .btn-submit {
        padding: 0.875rem 2rem;
        background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%);
        color: white;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-submit:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(15, 118, 110, 0.3);
    }

    .btn-cancel {
        padding: 0.875rem 2rem;
        background: white;
        color: #6b7280;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.2s;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-cancel:hover {
        background: #f9fafb;
        border-color: #d1d5db;
    }

    .error-message {
        padding: 1rem;
        background: #fee2e2;
        color: #991b1b;
        border-radius: 10px;
        margin-bottom: 1.5rem;
        font-size: 0.875rem;
    }

    .success-message {
        padding: 1rem;
        background: #d1fae5;
        color: #065f46;
        border-radius: 10px;
        margin-bottom: 1.5rem;
        font-size: 0.875rem;
    }

    @media (max-width: 768px) {
        .profile-edit-container {
            padding: 1rem;
        }

        .profile-form-card {
            padding: 1.5rem;
        }

        .form-grid {
            grid-template-columns: 1fr;
        }

        .checkbox-grid {
            grid-template-columns: 1fr;
        }

        .form-actions {
            flex-direction: column;
        }

        .btn-submit,
        .btn-cancel {
            width: 100%;
            justify-content: center;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="profile-edit-container">
    <a href="{% url 'workers:dashboard' %}" class="back-link">
        <i class="bi bi-arrow-left"></i> Back to Dashboard
    </a>

    <div class="page-header">
        <h1><i class="bi bi-person-circle"></i> Edit Profile</h1>
        <p>Complete your profile to increase your visibility and get more job opportunities</p>
    </div>

    <!-- Profile Completion -->
    <div class="profile-completion">
        <div class="completion-header">
            <span class="completion-title">Profile Completion</span>
            <span class="completion-percent">{{ profile.profile_completion }}%</span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" data-progress="{{ profile.profile_completion }}"></div>
        </div>
    </div>

    <!-- Messages -->
    {% if messages %}
    {% for message in messages %}
        <div class="{% if message.tags == 'error' %}error-message{% else %}success-message{% endif %}">
            <i class="bi bi-{% if message.tags == 'error' %}exclamation-triangle{% else %}check-circle{% endif %}"></i>
            {{ message }}
        </div>
    {% endfor %}
    {% endif %}

    <!-- Profile Image Upload (Separate Form) -->
    <div class="profile-form-card mb-4">
        <div class="form-section">
            <div class="section-header">
                <div class="section-icon">
                    <i class="bi bi-camera"></i>
                </div>
                <div class="section-title">
                    <h2>Profile Photo</h2>
                    <p>Upload a professional photo to help employers recognize you</p>
                </div>
            </div>

            <form method="post" action="{% url 'workers:profile_image_upload' %}" enctype="multipart/form-data" id="profileImageForm">
                {% csrf_token %}
                <div class="form-group">
                    <div class="profile-image-upload">
                        {% if profile.profile_image %}
                            <img src="{{ profile.profile_image.url }}" alt="Profile" class="current-profile-image" id="profileImagePreview">
                        {% else %}
                            <div class="profile-image-placeholder" id="profileImagePlaceholder">
                                {{ user.first_name.0 }}{{ user.last_name.0 }}
                            </div>
                        {% endif %}
                        <div class="profile-image-info">
                            <h4>Choose your profile photo</h4>
                            <p>JPG, PNG or GIF. Max size 5MB. Recommended: 400x400px</p>
                            {{ profile_image_form.profile_image }}
                            <button type="submit" class="btn btn-sm btn-primary mt-2" style="background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%); border: none; padding: 0.5rem 1rem; border-radius: 8px; color: white; font-weight: 600;">
                                <i class="bi bi-upload"></i> Upload Photo
                            </button>
                        </div>
                    </div>
                </div>
            </form>
            {% if profile.profile_image %}
            <form method="post" action="{% url 'workers:profile_image_remove' %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-danger mt-2" style="border-radius:8px; font-weight:600;">
                    <i class="bi bi-trash"></i> Remove Photo
                </button>
            </form>
            {% endif %}
        </div>
    </div>

    <!-- Main Profile Form -->
    <div class="profile-form-card">
        <form method="post">
            {% csrf_token %}

            <!-- Personal Information -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-person"></i>
                    </div>
                    <div class="section-title">
                        <h2>Personal Information</h2>
                        <p>Tell us about yourself and your professional background</p>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group full-width">
                        <label class="form-label" for="id_bio">
                            <i class="bi bi-chat-left-text"></i> Bio
                        </label>
                        {{ form.bio }}
                        <span class="form-help">Write a brief introduction about your skills and experience</span>
                    </div>
                </div>

                <div class="form-grid" style="margin-top: 1rem;">
                    <div class="form-group">
                        <label class="form-label" for="id_phone_number">
                            <i class="bi bi-telephone-fill"></i> Phone Number
                        </label>
                        <div style="position: relative;">
                            <input type="text" 
                                   name="phone_number" 
                                   id="id_phone_number" 
                                   class="form-control" 
                                   value="{{ request.user.phone_number }}"
                                   placeholder="+255712345678"
                                   maxlength="17"
                                   style="padding-left: 2.75rem;">
                            <i class="bi bi-phone" style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: #14b8a6; font-size: 1.125rem;"></i>
                        </div>
                        <span class="form-help"><i class="bi bi-info-circle me-1"></i>Include country code (e.g., +255 for Tanzania)</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="bi bi-envelope-fill"></i> Email Address
                        </label>
                        <div style="position: relative;">
                            <input type="email" 
                                   class="form-control" 
                                   value="{{ request.user.email }}"
                                   disabled
                                   style="padding-left: 2.75rem; background-color: #f9fafb; cursor: not-allowed;">
                            <i class="bi bi-envelope" style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: #9ca3af; font-size: 1.125rem;"></i>
                        </div>
                        <span class="form-help"><i class="bi bi-lock-fill me-1"></i>Email cannot be changed</span>
                    </div>
                </div>
            </div>

            <!-- Location -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-geo-alt"></i>
                    </div>
                    <div class="section-title">
                        <h2>Location</h2>
                        <p>Where are you based?</p>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="id_address">
                            <i class="bi bi-house"></i> Address
                        </label>
                        {{ form.address }}
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="id_city">
                            <i class="bi bi-building"></i> City
                        </label>
                        {{ form.city }}
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="id_state">
                            <i class="bi bi-map"></i> State/Province
                        </label>
                        {{ form.state }}
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="id_country">
                            <i class="bi bi-globe"></i> Country
                        </label>
                        {{ form.country }}
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="id_postal_code">
                            <i class="bi bi-mailbox"></i> Postal Code
                        </label>
                        {{ form.postal_code }}
                    </div>
                </div>

                <div class="form-grid" style="margin-top: 1rem;">
                    <div class="form-group">
                        <label class="form-label" for="id_religion">
                            <i class="bi bi-star"></i> Religion
                        </label>
                        {{ form.religion }}
                        <span class="form-help">Optional: Select your religion or prefer not to say</span>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="id_can_work_everywhere">
                            <i class="bi bi-globe2"></i> Work Flexibility
                        </label>
                        <div class="checkbox-item" style="margin-top: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                            {{ form.can_work_everywhere }}
                            <label for="id_can_work_everywhere" style="margin: 0; cursor: pointer; font-size: 0.9375rem; color: #4b5563;">
                                Can work everywhere (any location)
                            </label>
                        </div>
                        <span class="form-help">Check if you're willing to work at any location</span>
                    </div>
                </div>
            </div>

            <!-- Professional Details -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-briefcase"></i>
                    </div>
                    <div class="section-title">
                        <h2>Professional Details</h2>
                        <p>Your skills, experience, and rates</p>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="id_experience_years">
                            <i class="bi bi-clock-history"></i> Years of Experience
                        </label>
                        {{ form.experience_years }}
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="id_hourly_rate">
                            <i class="bi bi-currency-dollar"></i> Hourly Rate (USD)
                        </label>
                        <div class="input-group">
                            <span class="input-prefix">$</span>
                            {{ form.hourly_rate }}
                        </div>
                        <span class="form-help">Your hourly rate in US dollars</span>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="id_availability">
                            <i class="bi bi-calendar-check"></i> Availability
                        </label>
                        {{ form.availability }}
                    </div>
                </div>
            </div>

            <!-- Categories -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-tags"></i>
                    </div>
                    <div class="section-title">
                        <h2>Categories</h2>
                        <p>Select the categories you work in</p>
                    </div>
                </div>

                <div class="checkbox-grid">
                    {% for checkbox in form.categories %}
                        <div class="checkbox-item">
                            {{ checkbox.tag }}
                            <label for="{{ checkbox.id_for_label }}">{{ checkbox.choice_label }}</label>
                        </div>
                    {% endfor %}
                </div>
                
                <!-- Custom Categories -->
                {% if custom_categories %}
                <div style="margin-top: 1.25rem;">
                    <h3 style="font-size: 0.9375rem; color: #6b7280; margin-bottom: 0.75rem;">
                        <i class="bi bi-star-fill" style="color: #0f766e;"></i> Your Custom Categories
                    </h3>
                    <div style="display: grid; gap: 0.75rem;">
                        {% for category in custom_categories %}
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px;">
                            <div>
                                <strong style="color: #065f46;">{{ category.name }}</strong>
                                {% if category.is_verified %}
                                    <span style="color: #10b981; font-size: 0.75rem; margin-left: 0.5rem;"><i class="bi bi-check-circle-fill"></i> Verified</span>
                                {% else %}
                                    <span style="color: #f59e0b; font-size: 0.75rem; margin-left: 0.5rem;"><i class="bi bi-clock-fill"></i> Pending</span>
                                {% endif %}
                                <p style="margin: 0.25rem 0 0; font-size: 0.8125rem; color: #374151;">{{ category.description }}</p>
                            </div>
                            <button type="button" class="btn btn-sm delete-category-btn" data-category-id="{{ category.pk }}" style="color: #ef4444; background: white; border: 1px solid #ef4444; padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.8125rem;">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Note about Custom Categories -->
                <div style="margin-top: 1.25rem; padding: 0.75rem; background: #fef3c7; border: 1px solid #fbbf24; border-radius: 8px; text-align: center;">
                    <p style="margin: 0; color: #92400e; font-size: 0.875rem;">
                        <i class="bi bi-info-circle"></i> Don't see your category? <a href="#customCategoryForm" style="color: #0f766e; font-weight: 600; text-decoration: none;">Add it below</a> after saving your profile.
                    </p>
                </div>
            </div>

            <!-- Skills -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="bi bi-stars"></i>
                    </div>
                    <div class="section-title">
                        <h2>Skills</h2>
                        <p>Add your professional skills with optional certificates</p>
                    </div>
                </div>

                <!-- Custom Skills -->
                {% if custom_skills %}
                <div style="margin-bottom: 1.25rem;">
                    <h3 style="font-size: 0.9375rem; color: #6b7280; margin-bottom: 0.75rem;">
                        <i class="bi bi-award-fill" style="color: #0f766e;"></i> Your Skills
                    </h3>
                    <div style="display: grid; gap: 0.75rem;">
                        {% for skill in custom_skills %}
                        <div style="display: flex; justify-content: space-between; align-items: start; padding: 0.75rem; background: #eff6ff; border: 1px solid #93c5fd; border-radius: 8px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <strong style="color: #1e40af;">{{ skill.name }}</strong>
                                    {% if skill.is_verified %}
                                        <span style="color: #10b981; font-size: 0.75rem;"><i class="bi bi-check-circle-fill"></i> Verified</span>
                                    {% else %}
                                        <span style="color: #f59e0b; font-size: 0.75rem;"><i class="bi bi-clock-fill"></i> Pending</span>
                                    {% endif %}
                                    <span style="color: #6b7280; font-size: 0.75rem;">â€¢ {{ skill.years_of_experience }} years</span>
                                </div>
                                <p style="margin: 0.25rem 0; font-size: 0.8125rem; color: #374151;">{{ skill.description }}</p>
                                {% if skill.certificate %}
                                    <a href="{{ skill.certificate.url }}" target="_blank" style="font-size: 0.8125rem; color: #0f766e; text-decoration: none; display: inline-flex; align-items: center; gap: 0.25rem; margin-top: 0.25rem;">
                                        <i class="bi bi-file-earmark-check"></i> View Certificate
                                    </a>
                                {% endif %}
                            </div>
                            <button type="button" class="btn btn-sm delete-skill-btn" data-skill-id="{{ skill.pk }}" style="color: #ef4444; background: white; border: 1px solid #ef4444; padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.8125rem;">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Note about Custom Skills -->
                <div style="padding: 0.75rem; background: #dbeafe; border: 1px solid #3b82f6; border-radius: 8px; text-align: center;">
                    <p style="margin: 0; color: #1e3a8a; font-size: 0.875rem;">
                        <i class="bi bi-info-circle"></i> Want to add a skill? <a href="#customSkillFormSection" style="color: #0f766e; font-weight: 600; text-decoration: none;">Add it below</a> after saving your profile.
                    </p>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="submit" class="btn-submit">
                    <i class="bi bi-check-circle"></i> Save Changes
                </button>
                <a href="{% url 'workers:dashboard' %}" class="btn-cancel">
                    <i class="bi bi-x-circle"></i> Cancel
                </a>
            </div>
        </form>
    </div>

    <!-- Separate Forms for Custom Categories and Skills -->
    <div class="container" style="margin-top: 1.25rem; margin-bottom: 1.25rem;">
        <div class="row" style="display: flex;">
            <!-- Add Custom Category Form -->
            <div class="col-md-6 mb-3" id="customCategoryForm" style="display: flex;">
                <div style="padding: 1.25rem; background: #fef3c7; border: 2px dashed #fbbf24; border-radius: 10px; width: 100%; display: flex; flex-direction: column;">
                    <h3 style="font-size: 1rem; color: #92400e; margin-bottom: 0.75rem;">
                        <i class="bi bi-plus-circle"></i> Add Custom Category
                    </h3>
                    <form method="post" action="{% url 'workers:custom_category_add' %}" style="flex: 1; display: flex; flex-direction: column;">
                        {% csrf_token %}
                        <div style="margin-bottom: 0.75rem;">
                            <label style="font-size: 0.875rem; font-weight: 600; color: #374151; margin-bottom: 0.375rem; display: block;">
                                Category Name *
                            </label>
                            {{ custom_category_form.name }}
                        </div>
                        <div style="margin-bottom: 0.75rem; flex: 1;">
                            <label style="font-size: 0.875rem; font-weight: 600; color: #374151; margin-bottom: 0.375rem; display: block;">
                                Description
                            </label>
                            {{ custom_category_form.description }}
                        </div>
                        <button type="submit" class="btn" style="background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%); color: white; padding: 0.625rem 1.25rem; border-radius: 8px; font-weight: 600; border: none; width: 100%;">
                            <i class="bi bi-plus-circle"></i> Add Custom Category
                        </button>
                    </form>
                </div>
            </div>

            <!-- Add Custom Skill Form -->
            <div class="col-md-6 mb-3" id="customSkillFormSection" style="display: flex;">
                <div style="padding: 1.25rem; background: #dbeafe; border: 2px dashed #3b82f6; border-radius: 10px; width: 100%; display: flex; flex-direction: column;">
                    <h3 style="font-size: 1rem; color: #1e3a8a; margin-bottom: 0.75rem;">
                        <i class="bi bi-plus-circle"></i> Add Custom Skill
                    </h3>
                    <form method="post" action="{% url 'workers:custom_skill_add' %}" enctype="multipart/form-data" style="flex: 1; display: flex; flex-direction: column;">
                        {% csrf_token %}
                        <div style="margin-bottom: 0.75rem;">
                            <label style="font-size: 0.875rem; font-weight: 600; color: #374151; margin-bottom: 0.375rem; display: block;">
                                Skill Name *
                            </label>
                            {{ custom_skill_form.name }}
                        </div>
                        <div style="margin-bottom: 0.75rem; flex: 1;">
                            <label style="font-size: 0.875rem; font-weight: 600; color: #374151; margin-bottom: 0.375rem; display: block;">
                                Description
                            </label>
                            {{ custom_skill_form.description }}
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 0.75rem;">
                            <div>
                                <label style="font-size: 0.875rem; font-weight: 600; color: #374151; margin-bottom: 0.375rem; display: block;">
                                    Years of Experience *
                                </label>
                                {{ custom_skill_form.years_of_experience }}
                            </div>
                            <div>
                                <label style="font-size: 0.875rem; font-weight: 600; color: #374151; margin-bottom: 0.375rem; display: block;">
                                    Certificate (Optional)
                                </label>
                                {{ custom_skill_form.certificate }}
                            </div>
                        </div>
                        <button type="submit" class="btn" style="background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%); color: white; padding: 0.625rem 1.25rem; border-radius: 8px; font-weight: 600; border: none; width: 100%;">
                            <i class="bi bi-plus-circle"></i> Add Custom Skill
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Set progress bar width from data attribute
document.addEventListener('DOMContentLoaded', function() {
    const progressFill = document.querySelector('.progress-fill');
    if (progressFill) {
        const progress = progressFill.getAttribute('data-progress');
        progressFill.style.width = progress + '%';
    }

    // Profile image preview
    const profileImageInput = document.querySelector('input[name="profile_image"]');
    if (profileImageInput) {
        profileImageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Find or create the image element
                    let imgElement = document.getElementById('profileImagePreview');
                    const placeholder = document.getElementById('profileImagePlaceholder');
                    
                    if (!imgElement) {
                        // Create image element if it doesn't exist
                        imgElement = document.createElement('img');
                        imgElement.id = 'profileImagePreview';
                        imgElement.className = 'current-profile-image';
                        imgElement.alt = 'Profile';
                        
                        // Replace placeholder with image
                        if (placeholder) {
                            placeholder.parentNode.replaceChild(imgElement, placeholder);
                        } else {
                            document.querySelector('.profile-image-upload').insertBefore(
                                imgElement, 
                                document.querySelector('.profile-image-info')
                            );
                        }
                    }
                    
                    // Set the image source
                    imgElement.src = e.target.result;
                };
                reader.readAsDataURL(file);
                
                // Auto-submit the form after file selection (optional)
                // Uncomment the line below if you want automatic upload
                // document.getElementById('profileImageForm').submit();
            }
        });
    }

    // Handle delete category buttons
    document.querySelectorAll('.delete-category-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            if (confirm('Remove this category?')) {
                const categoryId = this.getAttribute('data-category-id');
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `/workers/custom-categories/${categoryId}/delete/`;
                
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrfmiddlewaretoken';
                csrfInput.value = csrfToken;
                
                form.appendChild(csrfInput);
                document.body.appendChild(form);
                form.submit();
            }
        });
    });

    // Handle delete skill buttons
    document.querySelectorAll('.delete-skill-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            if (confirm('Remove this skill?')) {
                const skillId = this.getAttribute('data-skill-id');
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `/workers/custom-skills/${skillId}/delete/`;
                
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrfmiddlewaretoken';
                csrfInput.value = csrfToken;
                
                form.appendChild(csrfInput);
                document.body.appendChild(form);
                form.submit();
            }
        });
    });
});
</script>
{% endblock %}
